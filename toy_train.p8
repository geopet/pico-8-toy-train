pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- toy train
-- by geopet (geoff petrie)

function _init()
  cls()
  switch_state=0
  train={{64,8},{72,8},{80,8}}
end

function _update()
  if (btnp(4)) then
    adv_switch()
  end

  move_train()
end

function _draw()
  map(0,0,0,0,16,16)
  draw_switch()
  draw_train()
end

function move_segment(s,dir)
  spd=dir*2
  if (s[2]==8) then -- top side
    if (s[1]==112) then -- top right
      s[2]+=spd
    else
      s[1]+=spd
    end
  else
    if (s[1]==112) then -- right side
      if (s[2]==112) then -- bottom right
        s[1]-=spd
      else
        s[2]+=spd
      end
    else
      if (s[2]==112) then -- bottom side
        if (s[1]==8) then -- bottom side
          s[2]-=spd
        else
          s[1]-=spd
        end
      else
        if (s[1]==8) then -- left side
          if (s[2]==8) then -- top left
            s[1]+=spd
          else
            s[2]-=spd
          end
        end
      end
    end
  end
end

function adv_switch()
  if (switch_state<1) then
    switch_state+=1
  else
    switch_state=0
  end
end

function move_train()
  for t in all (train) do
    move_segment(t,switch_state)
  end
end

function draw_train()
  local len=count(train)

  for t=1,len do
    if (t==1) then
      sprite=11
    else
      if (t==len) then
        sprite=13
      else
        sprite=12
      end
    end
    spr(sprite,train[t][1],train[t][2])
  end
end

function draw_switch()
  if (switch_state==1) then
    sspr(0,16,16,16,56,56,16,16)
  else
    sspr(64,16,16,16,56,56,16,16)
  end
end

__gfx__
0000000000000000444544444444444444444444444444444444444466666766bbbbbbbbbbbbbbbbbbbbbbbb0cccccc00cccccc00cccccc00000000000000000
00000000000000004444554444444444466666666666666666666664656d6676bbbbbbbbbbbbbbbbbbbbbbbbcddddddccddddddccddddddc0000000000000000
0070070000000000444445544444444446555555555555555555556466666666bbbbbbbbbbbbbbbbbbbbbbbbcdccccdccdccccdccdccccdc0000000000000000
0007700000000000444444554444445446566466646646646664656466656766bbbbbbbbbbbbbbbbbbbbbbbbcdccccdccdcddcdccdc11cdc0000000000000000
0007700000000000444444444444455446546466646646646646656466766666bbbbbbbbbbbbbbbbbbbbbbbbcdccccdccdcddcdccdc11cdc0000000000000000
0070070000000000444444444444454446564555555555555556656466666656bbbbbbbbbbbbbbbbbbbbbbbbcdccccdccdccccdccdccccdc0000000000000000
0000000000000000444544444444454446566566666666666656656466565666bbbbbbbbbbbbbbbbbbbbbbbbcddddddccddddddccddddddc0000000000000000
0000000000000000444554444444454446544564444444444654456467666666bbbbbbbbbbbbbbbbbbbbbbbb0cccccc00cccccc00cccccc00000000000000000
0000000000000000444455444444455446566564488884444656656444488884bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000444445544444445446566564448778444656656444877844bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000444445544444444446566564444877844654456448778444bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000444455444444455446544564444487784656656487784444bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000444554444444554446566564444487784656656487784444bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000445544444455544446566564444877844654456448778444bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000445444444454444446566564448778444656656444877844bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
0000000000000000445444444444444446544564488884444656656444488884bbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000
00000000000000000000000000000000465665644444444446544564667666660000000000000000000000000000000000000000000000000000000000000000
00000055550000000000005555000000465665666666666666566564699599960000005555000000000000000000000000000000000000000000000000000000
00005555555500000000555555550000465445555555555555546564699959960000555665550000000000000000000000000000000000000000000000000000
00055555556550000005555555555000465664664664664664664564695555960005555665555000000000000000000000000000000000000000000000000000
00555555566655000055555555555500465646664664664664666564695555960055555dd5555500000000000000000000000000000000000000000000000000
00555555dd6665000055555555555500465555555555555555555564699959960055555dd5555500000000000000000000000000000000000000000000000000
0555555dddd655500555555555555550466666666666666666666664699599960555555dd5555550000000000000000000000000000000000000000000000000
055555ddddd5555005dddddddddd6650444444444444444444444444666666760555555dd5555550000000000000000000000000000000000000000000000000
05555ddddd55555005dddddddddd6650666667666666667667666666666667660555555dd5555550000000000000000000000000000000000000000000000000
0555ddddd55555500555555555555550656d69959995656666565995599d66760555555dd5555550000000000000000000000000000000000000000000000000
005ddddd555555000055555555555500666669995996666666666959959666660055555dd5555500000000000000000000000000000000000000000000000000
0055ddd5555555000055555555555500666569555596676666766599595567660055555dd5555500000000000000000000000000000000000000000000000000
00055d55555550000005555555555000667669555596566666656595995666660005555dd5555000000000000000000000000000000000000000000000000000
00005555555500000000555555550000666669995996666666666959959666560000555dd5550000000000000000000000000000000000000000000000000000
00000055550000000000005555000000665659959996d656656d6995599656660000005555000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000676666666676666666666766676666660000000000000000000000000000000000000000000000000000000000000000
__map__
0203020302030203020302030203020300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1204050505050505050505050505061300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030736372702030212161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312130707070712131215161700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030707070702030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312130707070712131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0224252525252525252525252525260300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213121312131213121312131213121300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
